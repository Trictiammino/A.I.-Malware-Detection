import functions

# path del file
X_filtered_path = "dataset/X_filtered.csv"

# caricamento del file
X_filtered = functions.load(X_filtered_path)

# Addestramento dell'oggetto 'pca' sul dataframe fornito in input
pca, pca_list, explained_variance = functions.pca(X_filtered)

# Applicazione pca con metodo 'transform'
XPCA = functions.apply_pca(X_filtered, pca, pca_list)
print("\nXPCA\n", XPCA)

# selezione delle 'n' migliori feature in base alla soglia assegnata
n = functions.number_of_top_pc_select(explained_variance, 0.99)
print(f"\nNumero di componenti principali che superano la soglia indicata: {n}")

# Creazione di un dataset contenente le 'n' componenti principali selezionate
print("\nCreazione dataset 'XPCA_selected' con le componenti principali selezionate...")
XPCA_selected = XPCA.iloc[:, 0:n]
print("\nXPCA_selected shape:\n", XPCA_selected.shape)
print("\nXPCA_selected:\n", XPCA_selected)

# Salvando il dataset come 'XPCA_selected' nella cartella 'dataset'...")
print("\nSalvando le componenti principali selezionate come 'XPCA_selected' nella cartella 'dataset'...")
XPCA_selected.to_csv("dataset/XPCA_selected.csv", index=False)
print("\nSalvando le componenti principali selezionate come 'XPCA_selected' nella cartella 'dataset'... completato!\n")
